## 虚拟内存
> 参考资料：http://www.cs.cmu.edu/afs/cs/academic/class/15213-f15/www/schedule.html

### 虚拟内存是什么

- 概念上可以看成是存储在**磁盘**上的连续字节
- 这些字节有些被缓存到物理内存（DRAM）中，缓存的块被称为**页**

### 虚拟地址与物理地址

- 虚拟地址是逻辑地址，通过一个`MMU`(Memory Manage Unit)将虚拟地址翻译成物理地址

- 可能在一些简单的嵌入式设备中没有用到虚拟地址，而直接采用物理地址。但是在复杂的设备中（手机、服务器等），虚拟内存是必不可少的

### 虚拟内存的优点
- 将DRAM作为虚拟地址空间的一部分缓存
![](https://gblobscdn.gitbook.com/assets%2F-MRP-_mTHVixnnXPCTr3%2F-MeDAMFhriZUd6zHTOeC%2F-MeDANGSOYkpw27Ze3oK%2Fimage.png?alt=media&token=8bdd1036-233f-496d-8daf-937ac8dfb5bc)

- 为进程提供一个统一的视图
- 隔离地址空间：
    - 进程间无法访问内存
    - 用户程序无法访问操作系统内核信息和代码


### 动态内存分配

- 为什么要使用动态内存

    > 最主要的原因是知道程序运行时，才知道某些数据结构的大小

- new和malloc的区别（https://www.cnblogs.com/tp-16b/p/8684298.html）
    - 自由存储区的概念
    > 堆是操作系统维护的一块内存，而自由存储是C++中通过new与delete动态分配和释放对象的抽象概念。堆与自由存储区并不等价。

    大多数的编译器是在堆上实现的自由存储区，即通过调用`malloc`的包装函数`operator new`来实现。程序员也可通过重载new实现非堆的自由存储区，此时堆与自由存储区并不等价。

### 用户空间与内核空间
   > 本质上内存被分为这两个部分，区别在于访问权限不同
   - 当程序在内核空间中运行时，称程序运行在**内核态**
   - 当程序在用户空间中运行时，称程序运行在**用户态**